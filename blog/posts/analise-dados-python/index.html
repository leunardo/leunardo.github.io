<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Leonardo Alves">
    <meta name="description" content="Molhando a pontinha dos p√©s com dados">
    <title>Leonardo Alves - An√°lise de dados Python</title>
    <link rel="stylesheet" href="/index.css">
    <link rel="stylesheet" href="../../blog.css">
    <link rel="stylesheet" href="../posts.css">
    <link rel="stylesheet" href="/assets/monokai.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,300;0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <script type="application/ld+json">
    {
        "@context": "https://schema.org/",
        "@type": "BlogPosting",
        "name": "An√°lise de dados com Python",
        "headline": "An√°lise de dados com Python",
        "author": {
            "@type": "Person",
            "name": "Leonardo Alves",
            "url": "https://leonardoalves.dev"
        },
        "keywords": [
            "python",
            "data",
            "data-analysis",
            "pandas",
            "matplotlib"
        ],
        "image": "media/cover.jpg",
        "datePublished": "2017-12-13",
        "description": "Molhando a pontinha dos p√©s com dados"
    }
    </script>
</head>

<body>

    <header>
        <p><a href="/blog">Leonardo Alves blog</a></p>
    </header>

    <article>
        <h1>An√°lise de dados com Python</h1>
        <time datetime="2017-12-13">13 de Dezembro de 2017</time>
        <main>
            <img class="cover" src="media/cover.jpg" alt="Quatro pinguins no mar">

            <blockquote>
                <p>Data! Data! Data! I can't make bricks without clay!</p>
            </blockquote>
            <p class="cite">&mdash; Sir Arthur Conan Doyle</p>

            <p> Analisar os dados √© um passo essencial para que podemos entender o que est√° acontecendo
                e tamb√©m para decidirmos o que iremos fazer. Eles s√£o abstratos na maioria das vezes, e a sua
                interpreta√ß√£o
                requer tempo, mas quando conseguimos retirar a ess√™ncia, pegar o que os dados est√£o nos ‚Äúdizendo‚Äù, ent√£o
                a√≠ n√≥s
                conseguimos ver que os dados s√£o muito mais do que apenas dados. Por√©m, como eu fa√ßo pra ver al√©m do que
                est√° escrito na minha
                tela?
            </p>
            <p> Hoje eu irei apontar alguns t√≥picos importantes ao meu ver sobre a parte de visualiza√ß√£o
                e an√°lise,
                que eu fui adquirindo com o tempo, e tamb√©m mostrarei algumas partes de como se analisar o b√°sico dos
                dados
                utilizando Python com bibliotecas cient√≠ficas e de representa√ß√µes gr√°ficas. </p>
            <p> N√≥s teremos como dados para esse artigo, <strong>a temperatura m√©dia do solo dos pa√≠ses
                    desde
                    1750</strong>, que eu peguei diretamente do <a
                    href="https://www.kaggle.com/berkeleyearth/climate-change-earth-surface-temperature-data"
                    target="_blank">Berkeley Earth</a>.</p>

            <p> Bom, por onde come√ßar? Antes que voc√™ me diga: <i>‚Äúabrir um editor de texto, come√ßar a
                    importar as
                    bibliotecas do Python e os dados em csv‚Ä¶‚Äù</i>, Ainda n√£o! Primeiro vamos contextualizar: bom, os
                nossos dados
                s√£o sobre temperaturas, ent√£o o que sabemos sobre temperatura? </p>
            <ul>
                <li>√â medida em graus Celsius pelo Sistema Internacional;</li>
                <li>Varia durante o dia;</li>
                <li>H√° diferen√ßas grandes durante as esta√ß√µes (principalmente inverno e ver√£o);</li>
                <li>A cada dia que passa s√£o criadas tecnologias mais precisas para prever o clima;</li>
            </ul>
            <p> Ent√£o, antes de irmos para os dados, j√° temos ideia de que a temperatura provavelmente
                estar√° em
                Celsius, e √© interessante separar os dados por esta√ß√µes para podermos analis√°-los um por um, e a√≠ ter
                mais
                consist√™ncia, al√©m de poder ver a varia√ß√£o de temperatura por esta√ß√µes. A varia√ß√£o durante o dia n√£o √©
                realmente
                importante para n√≥s, j√° que temos a m√©dia, mas podemos considerar analis√°-la caso os dados possuam
                hor√°rio. </p>
            <hr>
            <p>Aqui est√° as bibliotecas que iremos utilizar:</p>

            <pre>
                <code data-language="python">
#imports
import pandas as pd # Pandas √© uma biblioteca para analise de dados
import matplotlib.pyplot as plt # Matplotlib para representa√ß√£o gr√°fica;
import numpy as np # Numpy e Scipy para computa√ß√£o cient√≠fica (utilizaremos para fazer a curva de pontos)
from scipy.optimize import curve_fit
from plot_erro import plor_erro
                </code>
            </pre>

            <h2>Vamos visualizar a temperatura geral do solo brasileiro.</h2>

            <pre>
                <code data-language="python">data = pd.read_csv('./src/GlobalLandTemperaturesByCountry.csv')
print(data.info())</code>
            </pre>

            <p>Teremos como resultado:</p>

            <pre>
                <code>
PS C:&sol;dev&sol;temperatura-terra&gt;python 01.py
&lt;class 'pandas.core.frame.DataFrame'&gt; Int64Index: 2164 entries, 77110 to 79289
Data columns (total 4 columns):
dt                              2164 non-null object
AverageTemperature              2164 non-null float64
AverageTemperatureUncertainty   2164 non-null float64
Country                         2164 non-null object
dtypes: float64(2), object(2)
memory usage: 17.6+ MB
None
                </code>
            </pre>
            <p>Agora sabemos que os nossos dados possuem quatro colunas:</p>
            <ul>
                <li>dt;</li>
                <li>AverageTemperature;</li>
                <li>AverageTemperatureUncertainty;</li>
                <li>Country;</li>
            </ul>
            <p>Onde <i>dt</i> √© a data de quando foi feita a medi√ß√£o, <i>AverageTemperature</i> √© a
                m√©dia de
                temperatura em si, <i>AverageTemperatureUncertainty</i> √© a incerteza da medida, o qual ser√° importante
                para temos
                uma no√ß√£o de precis√£o, e <i>Country</i> onde √© o pa√≠s de onde foi medido.</p>
            <p>Vamos agora filtrar para apenas dados do Brasil e ent√£o pegar 10 amostras:</p>

            <pre>
                <code data-language="python">
data = pd.read_csv('./src/GlobalLandTemperaturesByCountry.csv')
brasil = data.where(data.Country == 'Brazil')
print(brasil.sample(10))
                </code>
            </pre>
            <p>Sa√≠da:</p>
            <pre>
                <code>
PS C:&sol;dev&sol;temperatura-terra&gt; python01.py
         dt      AverageTemperature  AverageTemperatureUncertainty   Country
224087  NaN                     NaN                            NaN       NaN
250103  NaN                     NaN                            NaN       NaN
205439  NaN                     NaN                            NaN       NaN
70035   NaN                     NaN                            NaN       NaN
193227  NaN                     NaN                            NaN       NaN
518167  NaN                     NaN                            NaN       NaN
501803  NaN                     NaN                            NaN       NaN
537256  NaN                     NaN                            NaN       NaN
556422  NaN                     NaN                            NaN       NaN
479835  NaN                     NaN                            NaN       NaN
                </code>
            </pre>

            <p>Opa! O que aconteceu a√≠? Como assim NaN?! T√° bugado isso a√≠ meu!</p>
            <p>Infelizmente, quando n√≥s estamos a analisar os dados, eles n√£o s√£o sempre completos,
                muitas vezes
                eles vir√£o com brancos e lacunas que comprometem a nossa an√°lise, e isso acaba nos levando a tirar
                conclus√µes
                erradas. Um processo importante para conseguirmos ter mais confian√ßa, √© fazer a limpeza dos dados.</p>
            <p>Como se trata de temperaturas, na minha opini√£o a melhor sa√≠da (e mais f√°cil) √©
                simplesmente deletar
                esses registros vazios, porque n√£o faz sentido n√≥s tentarmos preencher os ‚Äúburacos‚Äù dos dados com base
                neles mesmos,
                visto que ao tentar isso possivelmente acabar√≠amos tendo uma conclus√£o menos precisa do que ter√≠amos se
                simplesmente
                ignor√°ssemos esses dados vazios.</p>
            <p>Ent√£o iremos dropar os registros vazios, com o comando <strong>brasil.dropna()</strong> e
                vamos
                continuar.</p>

            <pre>
                <code data-language="python">
brasil.dt = [d.split('-')[0] for d in brasil.dt] # formata a data de yyyy-mm-dd para yyyy
brasil_groupby_ano = brasil.groupby('dt')

# preparar exibicao

# converte o ano de string para int
x = [int(dt[0]) for dt in brasil_groupby_ano.dt]

# calcula a media das temperaturas em cada ano
y = brasil_groupby_ano.AverageTemperature.mean()

plt.scatter(x, y)
plt.title('Temperatura media do Brasil desde 1800')
plt.show()
                </code>
            </pre>

            <p>E olha s√≥ o que conseguimos üò±:</p>

            <img src="media/analise-dados-python-1.png" alt="Gr√°fico 'Temperatura m√©dia no Brasil desde 1800'.
            Exibindo no eixo y a temperatura de 23.5 at√© 26 graus c√©lsius.
            No eixo x, os anos de 1825 at√© 2000. V√°rios pontos azuis s√£o marcados exibindo uma certa
            tend√™ncia de subida ao chegar nos anos 2000.">


            <p>Olhando para este gr√°fico qualquer pessoa consegue notar que a temperatura est√°
                aumentando. Seria
                voc√™, aquecimento global?</p>
            <p>N√£o estou satisfeito. Vamos continuar. Que tal colocarmos uma linha que faz o trajeto
                desses pontos
                para confirmarmos que est√° aumentando a temperatura?</p>

            <pre>
                <code data-language="python">
...
# preparar exibicao

# converte o ano de string para int
x = [int(dt[0]) for dt in brasil_groupby_ano.dt]

# calcula media das temperaturas em cada ano
y = brasil_groupby_ano.AverageTemperature.mean()

# media do erro no ano
sigma = brasil_groupby_ano.AverageTemperatureUncertainty.mean()

plt.scatter(x, y) # adiciona os pontos no grafico
plt.title('Temperatura media do Brasil desde 1800')

# efetua a exponenciacao do numero pelo
# logaritmo natural + parametros de otimizacao
def exponenciar(x, a, b, c):
    return a * np.exp(-b * x) + c

# ajuste de curvas dada a nossa funcao e os eixos
popt, _ = curve_fit(exponenciar, x, y, p0=(1, 1e-6, 1), maxfev=4000, sigma=sigma)

xx = np.linspace(1800, 2020) # cria numeros iguais distribuidos de 1800 ate 2020
yy = exponenciar(xx, *popt) # yy = f(xx), adequados aos params de otimizacao

# essa funcao exibe uma linha com um sombreado em volta, representando a margem de erro
plot_erro(xx, yy, .05)

plt.show()
                </code>
            </pre>

            <p>Agora, baseando-se nos valores que conseguimos anteriormente, o c√≥digo acima ir√° tra√ßar
                uma linha que
                se ajusta aos valores. Infelizmente ficou complexo, e para n√≥s n√£o √© importante saber o que cada linha
                do c√≥digo
                faz, ent√£o irei ser mais conciso nessa parte. Caso voc√™ queira se aprofundar, deixarei o link para o
                source desse
                artigo com todos os c√≥digos e uma explica√ß√£o melhor em cima deles.</p>

            <img src="media/analise-dados-python-2.png" alt="Gr√°fico 'Temperatura m√©dia no Brasil desde 1800'.
            Exibindo no eixo y a temperatura de 23.5 at√© 26 graus c√©lsius.
            No eixo x, os anos de 1825 at√© 2000. V√°rios pontos azuis s√£o marcados exibindo uma certa
            tend√™ncia de subida ao chegar nos anos 2000.
            √â tra√ßado uma linha verde, que representa a m√©dia e o desvio padr√£o da temperatura em determinada √©poca.
            √â poss√≠vel ver que a linha est√° subindo gradativamente ao passar dos anos.">

            <p>Olha s√≥ üòé! Agora temos uma linha que representa o crescimento de temperatura ao longo
                dos anos. O
                verde mais claro seria a margem de erro, de 5% para mais ou para menos, como √© dito no <a
                    rel="noopener nofollow"
                    href="https://www.kaggle.com/berkeleyearth/climate-change-earth-surface-temperature-data"
                    target="_blank">source
                    de onde peguei os dados.</a></p>

            <p>A partir de agora, n√≥s podemos dizer que a temperatura do solo brasileiro, em m√©dia,
                aumentou 1,3¬∞
                Celsius em 200 anos com a nossa simples an√°lise. Por√©m, aqui √© s√≥ o come√ßo. Eu mostrei apenas uma
                pontinha do que
                podemos fazer e a ideia do que precisamos para visualizar os dados de alguma coisa. Resumindo, o b√°sico
                √©:</p>
            <ul>
                <li>Contextualizar, entender que tipo de dados estamos falando e pra que eles servem;</li>
                <li><i>Brainstorming</i>, jogar v√°rias ideias a cerca do contexto dos dados para termos ideias do que
                    seria
                    interessante analisar;</li>
                <li>Observar os dados que temos inicialmente;</li>
                <li>Limpar os dados;</li>
                <li>Aplicar as ideias em cima dos dados e transformar isso em algo (de prefer√™ncia graficamente)
                    represent√°vel;</li>
                <li>Chegar a conclus√µes;</li>
            </ul>
            <p>No in√≠cio do artigo eu falei sobre separar as temperaturas por esta√ß√µes e etc, e isso √©
                muito
                interessante e vale a pena fazer, por√©m como n√£o quero me estender muito, deixo isso para uma pr√≥xima
                conversa. Mas
                deixo o convite pra voc√™: que tal tentar levar isso como um <i>kickstart</i>? Boa sorte!</p>
            <h2>Refer√™ncias:</h2>
            <ul>
                <li><a target="_blank" rel="noopener nofollow"
                        href="https://www.amazon.com.br/Data-Science-Scratch-Principles-Python-ebook/dp/B00W4DTP2A/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1513189624&sr=1-1&keywords=data+science+from+scratch+first+principles+with+python">Data
                        Science from Scratch: First Principles with Python ‚Äî Joel Grus</a></li>
                <li><a target="_blank" rel="noopener nofollow" href="http://www.numpy.org/">numpy.org</a></li>
                <li><a target="_blank" rel="noopener nofollow" href="https://docs.scipy.org/">docs.scipy.org</a></li>
                <li><a target="_blank" rel="noopener nofollow"
                        href="https://matplotlib.org/contents.html">matplotlib.org</a></li>
                <li><a target="_blank" rel="noopener nofollow"
                        href="https://github.com/leunardo/medium-analise-dados">C√≥digo fonte:
                        github.com/leunardo/medium-analise-dados</a></li>
            </ul>
    </article>
    </main>

    <script src="/assets/rainbow-custom.min.js"></script>
</body>

</html>
